# 秒杀系统设计
===================
作者 helen222, 邮箱: helen@stu.pku.edu.cn
===================
## 秒杀客户端系统
### 环境配置
> 首次使用导入/seckill/sql中的sql数据库,秒杀商品信息表对应于数据库中的ms_activity，订单表对应于数据库中 的ms_order,订单日志表对应于数据库中的ms_order_log
>用户端html文件以及对应的后端逻辑处理php文件全部放在/seckill/public/endmiaosha文件夹下，配置好后进入login2.html页面输入用户名：user1，密码：1即可进行后续操作
>使用go创建的mssend以及mslogic服务器放在/seckill/public/miaosha文件夹下，下载后在终端编译后运行即可（共三台服务器：php订单预处理服务器（利用redis处理订单），mssend服务器（接收多台php服务器传来的消息，传入消息队列），mslogic（接收消息队列中的消息，对数据库进行写操作）
>配置redis
>配置rabbitmq

### 功能介绍
 + 登录页面
 ~~~
 （1）初次登录：用户输入用户名以及密码，使用post方法将用户名以及密码传输给后台进行处理，服务器端对输入的用户名以及密码与数据库中的用户名以及密码进行比对，两者不一致的情况下则需要重新输入密码，一致的情况下则生成一个token，返回给客户端并存储在客户端本地。
 （2）再次登录：用户不需要输入用户名密码，直接获取本地存储的token通过get方法放在请求头里面传给后台，后台解析token，获取用户名以及密码，进行比对分析，一致则跳转页面，不一致则要求重新输入
 （3）退出当前登录使用其它账号登录：当前客户端本地存储中已经token但用户仍然在输入框进行输入新的用户名以及密码即可判断为用户想要切换账户：首先清除本地存储中的token，然后后台按照用户新输入的用户名以及密码进行判断重新生成token返回给客户端，客户端存储新的token。
 （4）验证码功能：前端随机生成验证码，在前端最先判断验证码是否输入正确，正确则再进行后续的token判断，不正确则提醒用户输入错误
 ~~~
  + 商品详情页面
  ~~~
  （1）查询显示商品
  后台通过查询数据库中商品表的信息查看秒杀商品的信息并且返回给用户
  （2）跳转页面
  用户点击“详情”按钮进行页面的跳转跳转到此商品的秒杀页面中进行商品的秒杀
  ~~~
  + 秒杀页面
   ~~~
  （1）页面拦截：通过分析客户端的本地存储中是否存有token，如果没有则跳转到登录页面进行登录，如果有则进行下一步的操作
  （2）前端计时：在客户端显示当前时间距离商品秒杀的时间还有多长时间
  （3）订单处理：对当前时间以及秒杀开始时间和结束时间进行比较：
        [1]如果当前时间小于秒杀开始时间则对秒杀按钮设置disabled属性，用户不能点击，并且在按钮上显示还有多长时间才能点击按钮进行秒杀
        [2]如果当前时间处于秒杀开始时间与秒杀结束时间之间则用户可以点击按钮并将购买商品名称以及商品数量以及客户端存储的token（用来获取用户信息）发送给订单预处理服务器，订单预处理服务器比较redis中对应商品的剩余数量与用户欲购买的数量，如果用户欲购买的数量超过了redis中商品的剩余数量则返回“已没有库存”信息；如果用户欲购买的数量小于redis中商品的剩余数量则返回“秒杀成功”的信息，并解析token中的用户信息以及输入的商品信息传递给mssend的go服务器;mssend服务器接收php传过来的消息并且创建rabbitmq消息队列，将消息传给ranbbitmq队列（这样的话可以同时接收多个php传递过来的消息，进一步提高并发量）;订单后台处理器从rabbitmq消息队列中获取需要的用户信息以及商品信息，进行数据库的查询，首先判断用户欲购买的数量是否超出了数据库中对应商品的剩余数量，如果小于则返回“下单失败”信息，并在日志表中记录。如果没有则进行数据库操作：将用户id以及商品ID以及购买数量插入订单表；修改商品活动表中的商品总数信息；在日志表中记录“下单成功”信息。（并且返回给用户订单号）
 ~~~
 ## 秒杀系统后台管理端
 ### 环境配置
 > 配置thinkphp5，首次使用导入/seckill/sql中的sql数据库，所涉及到的表有：管理员表：admin；角色表：admin——group；admin_group_access；菜单表:menu；日志表：ms_order_log；商品信息表：ms_activity； 订单表：ms_order;
 
 ### 功能介绍
+ 用户注册、登录、退出
   用户初次登录的时候输入用户名以及密码，七天内可以免登录，登录成功后进入主页，点击右上方“退出”可以退出，从而使用其他账户
+ 菜单分级管理
~~~
    为每一个管理员组赋予对应可视化的menu子菜单，进而使得每个管理员组所看到的页面不一样，并且在common中写入权限管理，在每进入一个页面的时候进行权限管理。同时在进行增加修改删除操作的时候也进行用户权限的检查，防止非正常用户进行随意篡改系统。
    (1)高级管理员：管理商品信息、订单信息，分组信息，管理员信息以及日志信息
    (2)普通管理员组：管理订单，修改增加订单信息，管理商品，修改增加商品
    (3)普通用户：查询订单信息以及商品信息，不能增删改
~~~
+ 商品信息管理
查看增加修改删除商品信息
+ 订单信息管理
查看增加修改删除订单信息
+ 日志管理
查看日志信息
+ 用户信息管理
管理员管理：查看增加删除修改管理员信息
分组管理：查看增加删除修改分组信息
个人设置：修改重置个人信息
    
   



 
 
        
        
  
  
 
 
